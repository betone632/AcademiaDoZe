<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AcademiaDoZe.Presentation.AppMaui.Views.MatriculaPage"
             xmlns:vm="clr-namespace:AcademiaDoZe.Presentation.AppMaui.ViewModels"
             xmlns:enums="clr-namespace:AcademiaDoZe.Application.Enums;assembly=AcademiaDoZe.Application"
             xmlns:converters="clr-namespace:AcademiaDoZe.Presentation.AppMaui.Converters"
             x:DataType="vm:MatriculaViewModel"
             Title="{Binding Title}">

	<!-- =======================
         Styles importados da LogradouroListPage
         =======================-->
	<ContentPage.Resources>
		<ResourceDictionary>

			<converters:FotoToImageSourceConverter x:Key="FotoToImageSourceConverter" />
			<converters:DateOnlyToDateTimeConverter x:Key="DateOnlyConverter" />
			<converters:EnumDisplayConverter x:Key="EnumDisplay" />

			<!-- Estilo geral de card -->
			<Style x:Key="DashboardCardStyle" TargetType="Border">
				<Setter Property="StrokeShape">
					<Setter.Value>
						<RoundRectangle CornerRadius="18"/>
					</Setter.Value>
				</Setter>
				<Setter Property="Background">
					<Setter.Value>
						<LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
							<GradientStop Color="#40FFFFFF" Offset="0.0"/>
							<GradientStop Color="#10FFFFFF" Offset="1.0"/>
						</LinearGradientBrush>
					</Setter.Value>
				</Setter>
				<Setter Property="StrokeThickness" Value="0"/>
				<Setter Property="Padding" Value="12"/>
				<Setter Property="Margin" Value="15,10"/>
			</Style>

			<!-- Estilo específico de barra de busca (caso queira usar depois) -->
			<Style x:Key="SearchBarCardStyle" TargetType="Border" BasedOn="{StaticResource DashboardCardStyle}">
				<Setter Property="Padding" Value="10"/>
			</Style>

		</ResourceDictionary>
	</ContentPage.Resources>

	<!-- =======================
         Fundo gradiente igual ao LogradouroListPage
         =======================-->
	<ContentPage.Background>
		<LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
			<GradientStop Color="#1e3c72" Offset="0.1"/>
			<GradientStop Color="#2a5298" Offset="1.0"/>
		</LinearGradientBrush>
	</ContentPage.Background>

	<ScrollView>
		<StackLayout Spacing="20">

			<!-- CARD: Dados do Aluno -->
			<Border Style="{StaticResource DashboardCardStyle}">
				<StackLayout Spacing="15">

					<Label Text="Dados do Aluno" Style="{StaticResource SubHeadline}" TextColor="White"/>

					<Label Text="CPF" TextColor="White"/>

					<Grid ColumnDefinitions="*,Auto">
						<Entry Grid.Column="0"
                               Text="{Binding Matricula.AlunoMatricula.Cpf}"
                               Placeholder="000.000.000-00"
                               Keyboard="Numeric"
                               Margin="0,0,10,0"/>

						<Button Grid.Column="1"
                                Text=""
                                Command="{Binding SearchByCpfCommand}"
                                Style="{StaticResource ButtonPrimary}"
                                HeightRequest="40"
                                Padding="15,0">
							<Button.ImageSource>
								<FontImageSource FontFamily="MaterialIcons" Glyph="&#xe8b6;"/>
							</Button.ImageSource>
						</Button>
					</Grid>

					<!-- Card interno somente leitura -->
					<Border BackgroundColor="#30000000" Padding="10" StrokeThickness="0" Margin="0,10,0,0">
						<StackLayout Spacing="10">

							<Image Source="{Binding Matricula.AlunoMatricula.Foto, Converter={StaticResource FotoToImageSourceConverter}}"
                                   Aspect="AspectFit"
                                   HeightRequest="180"
                                   WidthRequest="180"
                                   HorizontalOptions="Start"
                                   Margin="0,10"/>

							<Label Text="{Binding Matricula.AlunoMatricula.Nome, StringFormat='Nome: {0}'}" TextColor="White"/>
							<Label Text="{Binding Matricula.AlunoMatricula.Cpf, StringFormat='CPF: {0}'}" TextColor="White"/>
							<Label Text="{Binding Matricula.AlunoMatricula.DataNascimento, StringFormat='Nascimento: {0:dd/MM/yyyy}'}" TextColor="White"/>
							<Label Text="{Binding Matricula.AlunoMatricula.Email, StringFormat='Email: {0}'}" TextColor="White"/>
							<Label Text="{Binding Matricula.AlunoMatricula.Telefone, StringFormat='Telefone: {0}'}" TextColor="White"/>

						</StackLayout>
					</Border>

				</StackLayout>
			</Border>

			<!-- CARD: Laudo Médico -->
			<Border Style="{StaticResource DashboardCardStyle}">
				<StackLayout Spacing="15">

					<Label Text="Láudo Médico" Style="{StaticResource SubHeadline}" TextColor="White"/>

					<Image Source="{Binding Matricula.LaudoMedico, Converter={StaticResource FotoToImageSourceConverter}}"
                           Aspect="AspectFill"
                           HeightRequest="120"
                           WidthRequest="120">
						<Image.GestureRecognizers>
							<TapGestureRecognizer Command="{Binding SelecionarFotoCommand}"/>
						</Image.GestureRecognizers>
					</Image>

					<Button Text="Selecionar Imagem"
                            Command="{Binding SelecionarFotoCommand}"
                            Style="{StaticResource ButtonPrimary}">
						<Button.ImageSource>
							<FontImageSource FontFamily="MaterialIcons" Glyph="&#xe226;"/>
						</Button.ImageSource>
					</Button>

				</StackLayout>
			</Border>

			<!-- CARD: Tipo de Plano -->
			<Border Style="{StaticResource DashboardCardStyle}">
				<StackLayout Spacing="15">

					<Label Text="Tipo de Plano" Style="{StaticResource SubHeadline}" TextColor="White"/>

					<StackLayout Spacing="5">
						<Label Text="Plano" TextColor="White"/>
						<Picker ItemsSource="{Binding MatriculaPlanos}" SelectedItem="{Binding Plano}">
							<Picker.ItemDisplayBinding>
								<Binding Converter="{StaticResource EnumDisplay}"/>
							</Picker.ItemDisplayBinding>
						</Picker>
					</StackLayout>

					<StackLayout Spacing="5">
						<Label Text="Data de início" TextColor="White"/>
						<DatePicker Date="{Binding DataInicio, Converter={StaticResource DateOnlyConverter}, Mode=TwoWay}"/>
					</StackLayout>

					<StackLayout Spacing="5">
						<Label Text="Data Final" TextColor="White"/>
						<DatePicker Date="{Binding DataFim, Converter={StaticResource DateOnlyConverter}, Mode=TwoWay}"/>
					</StackLayout>

					<StackLayout Spacing="5">
						<Label Text="Objetivo" TextColor="White"/>
						<Entry Text="{Binding Matricula.Objetivo}" Placeholder="Hipertrofia, emagrecimento etc..."/>
					</StackLayout>

					<!-- Restrições -->
					<StackLayout Spacing="10">
						<Label Text="Restrições Médicas" Style="{StaticResource SubHeadline}" TextColor="White"/>

						<FlexLayout Wrap="Wrap" Direction="Row" AlignItems="Center" JustifyContent="Start">
							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasDiabetes}" />
								<Label Text="Diabetes" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>

							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasPressaoAlta}" />
								<Label Text="Pressão Alta" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>

							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasLabirintite}" />
								<Label Text="Labirintite" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>

							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasAlergias}" />
								<Label Text="Alergias" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>

							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasProblemasRespiratorios}" />
								<Label Text="Problemas Respiratórios" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>

							<StackLayout Orientation="Horizontal" Margin="10,5">
								<CheckBox IsChecked="{Binding HasRemedioContinuo}" />
								<Label Text="Remédio Contínuo" VerticalOptions="Center" TextColor="White"/>
							</StackLayout>
						</FlexLayout>

					</StackLayout>

				</StackLayout>
			</Border>

			<!-- Botões -->
			<Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="15,10">
				<Button Grid.Column="0" Text="Cancelar" Command="{Binding CancelCommand}" Style="{StaticResource ButtonSecondary}" HeightRequest="50"/>
				<Button Grid.Column="1" Text="Salvar" Command="{Binding SaveMatriculaCommand}" Style="{StaticResource ButtonPrimary}" HeightRequest="50"/>
			</Grid>

			<ActivityIndicator IsVisible="{Binding IsBusy}"
                               IsRunning="{Binding IsBusy}"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               Color="White"/>
		</StackLayout>
	</ScrollView>
</ContentPage>
